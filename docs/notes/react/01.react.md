---
title: React
createTime: 2025/05/30 16:00:16
permalink: /react/
---

::: note
ä¸­æ–‡å®˜ç½‘ï¼š<https://zh-hans.react.dev/>
:::

## å¿«é€Ÿå…¥é—¨

React åº”ç”¨ç¨‹åºæ˜¯ç”± ç»„ä»¶ ç»„æˆçš„ã€‚ä¸€ä¸ªç»„ä»¶æ˜¯ UIï¼ˆç”¨æˆ·ç•Œé¢ï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„é€»è¾‘å’Œå¤–è§‚ã€‚ç»„ä»¶å¯ä»¥å°åˆ°ä¸€ä¸ªæŒ‰é’®ï¼Œä¹Ÿå¯ä»¥å¤§åˆ°æ•´ä¸ªé¡µé¢ã€‚

**React ç»„ä»¶æ˜¯è¿”å›æ ‡ç­¾çš„ JavaScript å‡½æ•°**ï¼š

```js
function MyButton() {
  return <button>æˆ‘æ˜¯ä¸€ä¸ªæŒ‰é’®</button>;
}
```

::: note
React ç»„ä»¶å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œè€Œ HTML æ ‡ç­¾åˆ™å¿…é¡»æ˜¯å°å†™å­—æ¯ã€‚
:::

### ä½¿ç”¨ JSX ç¼–å†™æ ‡ç­¾

JSX æ¯” HTML æ›´åŠ ä¸¥æ ¼ã€‚ä½ å¿…é¡»é—­åˆæ ‡ç­¾ï¼Œå¦‚ `<br />`ã€‚ä½ çš„ç»„ä»¶ä¹Ÿä¸èƒ½è¿”å›å¤šä¸ª JSX æ ‡ç­¾ã€‚ä½ å¿…é¡»å°†å®ƒä»¬åŒ…è£¹åˆ°ä¸€ä¸ªå…±äº«çš„çˆ¶çº§ä¸­ï¼Œæ¯”å¦‚ `<div>...</div>` æˆ–ä½¿ç”¨ç©ºçš„ `<></>` åŒ…è£¹ï¼š

### æ·»åŠ æ ·å¼

åœ¨ React ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ className æ¥æŒ‡å®šä¸€ä¸ª CSS çš„ classã€‚å®ƒä¸ HTML çš„ class å±æ€§çš„å·¥ä½œæ–¹å¼ç›¸åŒ

```html
<img className="avatar" />
```

### æ˜¾ç¤ºæ•°æ®

JSX ä¼šè®©ä½ æŠŠæ ‡ç­¾æ”¾åˆ° JavaScript ä¸­ã€‚è€Œå¤§æ‹¬å·ä¼šè®©ä½  â€œå›åˆ°â€ JavaScript ä¸­ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä»ä½ çš„ä»£ç ä¸­åµŒå…¥ä¸€äº›å˜é‡å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œè¿™å°†æ˜¾ç¤º `user.name`ï¼š

```js
return <h1>{user.name}</h1>;
```

ä½ è¿˜å¯ä»¥å°† JSX å±æ€§ â€œè½¬ä¹‰åˆ° JavaScriptâ€ï¼Œä½†ä½ å¿…é¡»ä½¿ç”¨å¤§æ‹¬å· è€Œé å¼•å·ã€‚ä¾‹å¦‚ï¼Œ`className="avatar"` æ˜¯å°† "avatar" å­—ç¬¦ä¸²ä¼ é€’ç»™ classNameï¼Œä½œä¸º CSS çš„ classã€‚ä½† `src={user.imageUrl}` ä¼šè¯»å– JavaScript çš„ `user.imageUrl` å˜é‡ï¼Œç„¶åå°†è¯¥å€¼ä½œä¸º src å±æ€§ä¼ é€’ï¼š

```js
return <img className="avatar" src={user.imageUrl} />;
```

### æ¡ä»¶æ¸²æŸ“

React æ²¡æœ‰ç‰¹æ®Šçš„è¯­æ³•æ¥ç¼–å†™æ¡ä»¶è¯­å¥ï¼Œå› æ­¤ä½ ä½¿ç”¨çš„å°±æ˜¯æ™®é€šçš„ JavaScript ä»£ç ã€‚

```js
let content;
if (isLoggedIn) {
  content = <AdminPanel />;
} else {
  content = <LoginForm />;
}
return <div>{content}</div>;
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦

```js
<div>{isLoggedIn ? <AdminPanel /> : <LoginForm />}</div>

<div>
  {isLoggedIn && <AdminPanel />}
</div>
```

### åˆ—è¡¨æ¸²æŸ“

ä½ å°†ä¾èµ– JavaScript çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ for å¾ªç¯ å’Œ array çš„ map() å‡½æ•° æ¥æ¸²æŸ“ç»„ä»¶åˆ—è¡¨ã€‚

```js
const products = [
  { title: "Cabbage", id: 1 },
  { title: "Garlic", id: 2 },
  { title: "Apple", id: 3 },
];

const listItems = products.map((product) => <li key={product.id}>{product.title}</li>);

return <ul>{listItems}</ul>;
```

### å“åº”äº‹ä»¶

ä½ å¯ä»¥é€šè¿‡åœ¨ç»„ä»¶ä¸­å£°æ˜ äº‹ä»¶å¤„ç† å‡½æ•°æ¥å“åº”äº‹ä»¶ï¼š

```js
function MyButton() {
  function handleClick() {
    alert("You clicked me!");
  }

  return <button onClick={handleClick}>ç‚¹æˆ‘</button>;
}

// ä¼ å‚æ•°çš„å†™æ³•
function MyButton() {
  function handleClick(name) {
    alert("Hello, " + name);
  }

  return <button onClick={() => handleClick("Evan")}>ç‚¹æˆ‘</button>;
}
```

æ³¨æ„ï¼Œ`onClick={handleClick}` çš„ç»“å°¾æ²¡æœ‰å°æ‹¬å·ï¼ä¸è¦ è°ƒç”¨ äº‹ä»¶å¤„ç†å‡½æ•°ï¼šä½ åªéœ€ æŠŠå‡½æ•°ä¼ é€’ç»™äº‹ä»¶ å³å¯ã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ React ä¼šè°ƒç”¨ä½ ä¼ é€’çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚

### ä½¿ç”¨ Hook

ä»¥ `use` å¼€å¤´çš„å‡½æ•°è¢«ç§°ä¸º Hookã€‚`useState` æ˜¯ React æä¾›çš„ä¸€ä¸ªå†…ç½® Hookã€‚ä½ å¯ä»¥åœ¨ [React API å‚è€ƒ](https://zh-hans.react.dev/reference/react) ä¸­æ‰¾åˆ°å…¶ä»–å†…ç½®çš„ Hookã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç»„åˆç°æœ‰çš„ Hook æ¥ç¼–å†™å±äºä½ è‡ªå·±çš„ Hookã€‚

Hook æ¯”æ™®é€šå‡½æ•°æ›´ä¸ºä¸¥æ ¼ã€‚ä½ åªèƒ½åœ¨ä½ çš„ç»„ä»¶ï¼ˆæˆ–å…¶ä»– Hookï¼‰çš„ é¡¶å±‚ è°ƒç”¨ Hookã€‚å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªæ¡ä»¶æˆ–å¾ªç¯ä¸­ä½¿ç”¨ `useState`ï¼Œè¯·æå–ä¸€ä¸ªæ–°çš„ç»„ä»¶å¹¶åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨å®ƒã€‚

### Props

å¯ä»¥é€šè¿‡ `props` å°†æ•°æ®ä¼ é€’ç»™ç»„ä»¶ã€‚

```js
export default function MyApp() {
  const [count, setCount] = useState(0);

  function handleClick() {
    setCount(count + 1);
  }

  return (
    <div>
      <MyButton count={count} onClick={handleClick} />
    </div>
  );
}

function MyButton({ count, onClick }) {
  return <button onClick={onClick}>ç‚¹äº† {count} æ¬¡</button>;
}
```

## React Hooks

Hook å¯ä»¥å¸®åŠ©åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ä¸åŒçš„ React åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„ Hook æˆ–ä½¿ç”¨è‡ªå®šä¹‰ Hookã€‚

### `useState`

åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ `useState` æ¥å£°æ˜ä¸€ä¸ª**çŠ¶æ€å˜é‡**ã€‚

```js
const [state, setState] = useState(initialState);
```

#### å‚æ•°

- `initialState`ï¼šåˆå§‹çŠ¶æ€ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯çº¯å‡½æ•°ï¼ˆç›´æ¥ä¼ é€’åˆå§‹åŒ–å‡½æ•°æœ¬èº«ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„è°ƒç”¨ç»“æœï¼‰

#### è¿”å›å€¼

- `state`ï¼šå½“å‰çŠ¶æ€
- `setState`ï¼šæ›´æ–°çŠ¶æ€çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥è®©ä½ å°† state æ›´æ–°ä¸ºä¸åŒçš„å€¼å¹¶è§¦å‘é‡æ–°æ¸²æŸ“

#### æ³¨æ„

`useState` è¿”å›çš„ `setState` å‡½æ•°å…è®¸ä½ å°† state æ›´æ–°ä¸ºä¸åŒçš„å€¼å¹¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä½ å¯ä»¥ç›´æ¥ä¼ é€’æ–°çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªæ ¹æ®å…ˆå‰çŠ¶æ€æ¥è®¡ç®—æ–°çŠ¶æ€çš„å‡½æ•°ï¼š

::: note
è°ƒç”¨ `setState` å‡½æ•° ä¸ä¼š æ”¹å˜å·²ç»æ‰§è¡Œçš„ä»£ç ä¸­å½“å‰çš„ stateã€‚

å®ƒåªå½±å“ ä¸‹ä¸€æ¬¡ æ¸²æŸ“ä¸­ `useState` è¿”å›çš„å†…å®¹ã€‚
:::

```js
const [name, setName] = useState("Taylor");

function handleClick() {
  setName("Robin");
  console.log(name); // Still "Taylor"!
}
```

1ï¸âƒ£ ç›´æ¥ä¼ é€’æ–°çŠ¶æ€

```js
const [age, setAge] = useState(42);

function handleClick() {
  setAge(age + 1); // setAge(42 + 1)
  setAge(age + 1); // setAge(42 + 1)
  setAge(age + 1); // setAge(42 + 1)
}
```

ç‚¹å‡»ä¸€æ¬¡åï¼Œ`age` å°†åªä¼šå˜ä¸º 43 è€Œä¸æ˜¯ 45ï¼è¿™æ˜¯å› ä¸ºè°ƒç”¨ `set` å‡½æ•° ä¸ä¼šæ›´æ–° å·²ç»è¿è¡Œä»£ç ä¸­çš„ `age` çŠ¶æ€å˜é‡ã€‚å› æ­¤ï¼Œæ¯ä¸ª `setAge(age + 1)` è°ƒç”¨å˜æˆäº† `setAge(43)`ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å‘ `setAge` ä¼ é€’ä¸€ä¸ª æ›´æ–°å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼š

2ï¸âƒ£ ä¼ é€’æ›´æ–°å‡½æ•°

```js
const [age, setAge] = useState(42);

function handleClick() {
  setAge((a) => a + 1); // setAge(42 => 43)
  setAge((a) => a + 1); // setAge(43 => 44)
  setAge((a) => a + 1); // setAge(44 => 45)
}
```

è¿™é‡Œï¼Œ`a => a + 1` æ˜¯æ›´æ–°å‡½æ•°ã€‚å®ƒè·å– **å¾…å®šçŠ¶æ€** å¹¶ä»ä¸­è®¡ç®— **ä¸‹ä¸€ä¸ªçŠ¶æ€**ã€‚

::: note
ä½ å¯ä»¥å°†å¯¹è±¡å’Œæ•°ç»„æ”¾å…¥çŠ¶æ€ä¸­ã€‚åœ¨ React ä¸­ï¼ŒçŠ¶æ€è¢«è®¤ä¸ºæ˜¯åªè¯»çš„ï¼Œå› æ­¤ ä½ åº”è¯¥æ›¿æ¢å®ƒè€Œä¸æ˜¯æ”¹å˜ç°æœ‰å¯¹è±¡ã€‚

å¯ä»¥ä½¿ç”¨åƒ [Immer](https://github.com/immerjs/use-immer) è¿™æ ·çš„åº“æ¥å‡å°‘é‡å¤çš„ä»£ç ã€‚
:::

```js
// âœ… ä½¿ç”¨æ–°å¯¹è±¡æ›¿æ¢ state
setForm({
  ...form,
  firstName: "Taylor",
});
```

#### ä½¿ç”¨ key é‡ç½®çŠ¶æ€

ä½ å¯ä»¥é€šè¿‡å‘ç»„ä»¶ä¼ é€’ä¸åŒçš„ `key` æ¥é‡ç½®ç»„ä»¶çš„çŠ¶æ€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé‡ç½®æŒ‰é’®æ”¹å˜ `version` çŠ¶æ€å˜é‡ï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸ºä¸€ä¸ª `key` ä¼ é€’ç»™ `Form` ç»„ä»¶ã€‚å½“ `key` æ”¹å˜æ—¶ï¼ŒReact ä¼šä»å¤´å¼€å§‹é‡æ–°åˆ›å»º `Form` ç»„ä»¶ï¼ˆä»¥åŠå®ƒçš„æ‰€æœ‰å­ç»„ä»¶ï¼‰ï¼Œæ‰€ä»¥å®ƒçš„çŠ¶æ€è¢«é‡ç½®äº†ã€‚

```js
export default function App() {
  const [version, setVersion] = useState(0);

  function handleReset() {
    setVersion(version + 1);
  }

  return (
    <>
      <button onClick={handleReset}>Reset</button>
      <Form key={version} />
    </>
  );
}
```

#### å§‹ç»ˆåœ¨çŠ¶æ€ä¸­æ›¿æ¢å¯¹è±¡å’Œæ•°ç»„

å¦‚æœä¸‹ä¸€ä¸ªçŠ¶æ€ç­‰äºå…ˆå‰çš„çŠ¶æ€ï¼ŒReact å°†å¿½ç•¥ä½ çš„æ›´æ–°ï¼Œè¿™æ˜¯ç”± Object.is æ¯”è¾ƒç¡®å®šçš„ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ä½ ç›´æ¥æ›´æ”¹çŠ¶æ€ä¸­çš„å¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼š

```js
obj.x = 10; // ğŸš© é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹ç°æœ‰çš„å¯¹è±¡
setObj(obj); // ğŸš© ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…
```

ä½ ä¿®æ”¹äº†ä¸€ä¸ªç°æœ‰çš„ `obj` å¯¹è±¡å¹¶å°†å…¶ä¼ é€’å› `setObj`ï¼Œå› æ­¤ React å¿½ç•¥äº†æ›´æ–°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦ç¡®ä¿å§‹ç»ˆåœ¨çŠ¶æ€ä¸­ **æ›¿æ¢** å¯¹è±¡å’Œæ•°ç»„ï¼Œè€Œä¸æ˜¯å¯¹å®ƒä»¬è¿›è¡Œ **æ›´æ”¹**ï¼š

```js
// âœ… æ­£ç¡®ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
setObj({
  ...obj,
  x: 10,
});
```

#### å°† state åˆå§‹åŒ–ä¸ºå‡½æ•°

å¦‚æœéœ€è¦ç”¨ `state` å˜é‡æ¥å­˜å‚¨å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥æŠŠå‡½æ•°èµ‹å€¼ç»™ `state`ï¼Œè€Œæ˜¯éœ€è¦ç”¨ç®­å¤´å‡½æ•°æ¥èµ‹å€¼ã€‚

```js
const [fn, setFn] = useState(() => someFunction);

function handleClick() {
  setFn(() => someOtherFunction);
}
```

### `useReducer`

åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ `useReducer` æ¥ç®¡ç†å¤æ‚çš„ `state` é€»è¾‘ã€‚ç®€å•æ¥è¯´ï¼Œ`useReducer` å¯ä»¥è®©ä½ åƒå†™ Redux ä¸€æ ·ç®¡ç†æœ¬åœ° `state`ã€‚

```js
const [state, dispatch] = useReducer(reducer, initialArg, init?)
```

#### å‚æ•°

- `reducer`ï¼šä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶å½“å‰çš„ `state` å’Œè¦æ‰§è¡Œçš„ `action`ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ª `state`ã€‚
- `initialArg`ï¼šç”¨äºåˆå§‹åŒ– `state` çš„ä»»æ„å€¼ã€‚åˆå§‹å€¼çš„è®¡ç®—é€»è¾‘å–å†³äºæ¥ä¸‹æ¥çš„ `init` å‚æ•°
- `init`ï¼šç”¨äºè®¡ç®—åˆå§‹å€¼çš„å‡½æ•°ã€‚å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨ `init(initialArg)` çš„æ‰§è¡Œç»“æœä½œä¸ºåˆå§‹å€¼ï¼Œå¦åˆ™ä½¿ç”¨ `initialArg`

#### è¿”å›å€¼

- `state`ï¼šå½“å‰çŠ¶æ€ã€‚åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œå®ƒæ˜¯ `init(initialArg)` æˆ– `initialArg` ï¼ˆå¦‚æœæ²¡æœ‰ `init` å‡½æ•°ï¼‰ã€‚
- `dispatch`ï¼šä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª `action` å¹¶è°ƒç”¨ `reducer` æ¥è®¡ç®—ä¸‹ä¸€ä¸ª `state`ã€‚

é€šå¸¸æ¥è¯´ `action` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ `type` å±æ€§æ ‡è¯†ç±»å‹ï¼Œå…¶å®ƒå±æ€§æºå¸¦é¢å¤–ä¿¡æ¯ã€‚

#### ç¤ºä¾‹

```js
function reducer(state, action) {
  switch (action.type) {
    case "increment":
      return { count: state.count + 1 };
    case "decrement":
      return { count: state.count - 1 };
    default:
      return state;
  }
}

// init å‡½æ•°ï¼šæ¥æ”¶ initialArgï¼Œè¿”å›åˆå§‹ state
function init(initialCount) {
  return { count: initialCount * 2 };
}

export default function Counter({ initialCount }) {
  // è¿™é‡Œç”¨åˆ°äº† initialArg å’Œ init
  const [state, dispatch] = useReducer(reducer, initialCount, init);

  return (
    <>
      <button onClick={() => dispatch({ type: "decrement" })}>-</button>
      <span>{state.count}</span>
      <button onClick={() => dispatch({ type: "increment" })}>+</button>
    </>
  );
}

// ä½¿ç”¨
<Counter initialCount={5} />;
```

#### æ³¨æ„

`dispatch` å‡½æ•° æ˜¯ä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“è€Œæ›´æ–° `state`ã€‚å› æ­¤åœ¨è°ƒç”¨ `dispatch` å‡½æ•°åè¯»å– `state` å¹¶ä¸ä¼šæ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½è·å–åˆ°è°ƒç”¨å‰çš„å€¼ã€‚

`useReducer` å’Œ `useState` éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒå¯ä»¥è®©ä½ æŠŠçŠ¶æ€æ›´æ–°é€»è¾‘ä»äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ç§»åŠ¨åˆ°ç»„ä»¶å¤–éƒ¨ã€‚è¯¦æƒ…å¯ä»¥å‚é˜… [å¯¹æ¯” useState å’Œ useReducer](https://zh-hans.react.dev/learn/comparing-use-state-and-use-reducer)ã€‚

### `useContext`

ä¸Šä¸‹æ–‡å¸®åŠ©ç»„ä»¶ ä»ç¥–å…ˆç»„ä»¶æ¥æ”¶ä¿¡æ¯ï¼Œè€Œæ— éœ€å°†å…¶ä½œä¸º `props` ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºçš„é¡¶å±‚ç»„ä»¶å¯ä»¥å€ŸåŠ©ä¸Šä¸‹æ–‡å°† UI ä¸»é¢˜ä¼ é€’ç»™æ‰€æœ‰ä¸‹æ–¹çš„ç»„ä»¶ï¼Œæ— è®ºè¿™äº›ç»„ä»¶å±‚çº§æœ‰å¤šæ·±ã€‚

```js
const value = useContext(SomeContext);
```

#### ç¤ºä¾‹

```js
const ThemeContext = createContext(null); // åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œé»˜è®¤å€¼ä¸º null

export default function MyPage() {
  return (
    <ThemeContext value="dark">
      <MyButton />
    </ThemeContext>
  );
}
```

```js
function MyButton() {
  const theme = useContext(ThemeContext);
  return <button className={theme}>Submit</button>;
}
```

### `useRef`

`ref` å…è®¸ç»„ä»¶ ä¿å­˜ä¸€äº›ä¸ç”¨äºæ¸²æŸ“çš„ä¿¡æ¯ã€‚æ›´æ–° `ref` ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

`ref` æ˜¯ä» React èŒƒä¾‹ä¸­çš„â€œè„±å›´æœºåˆ¶â€ã€‚å½“éœ€è¦ä¸é React ç³»ç»Ÿå¦‚æµè§ˆå™¨å†…ç½® API ä¸€åŒå·¥ä½œæ—¶ï¼Œ`ref` å°†ä¼šéå¸¸æœ‰ç”¨ã€‚

```js
const ref = useRef(initialValue);
```

#### å‚æ•°

- `initialValue`ï¼šref å¯¹è±¡çš„ current å±æ€§çš„åˆå§‹å€¼ã€‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ã€‚è¿™ä¸ªå‚æ•°åœ¨é¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥ã€‚

#### è¿”å›å€¼

- `ref`ï¼šä¸€ä¸ªåŒ…å« `current` å±æ€§çš„å¯¹è±¡ã€‚`current` å±æ€§åˆå§‹å€¼ä¸ºä¼ é€’çš„ `initialValue`ã€‚ä¹‹åå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼ã€‚å¦‚æœå°† `ref` å¯¹è±¡ä½œä¸ºä¸€ä¸ª JSX èŠ‚ç‚¹çš„ `ref` å±æ€§ä¼ é€’ç»™ Reactï¼ŒReact å°†ä¸ºå®ƒè®¾ç½® `current` å±æ€§ã€‚

#### æ³¨æ„

æ”¹å˜ `ref` ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚è¿™æ„å‘³ç€ `ref` æ˜¯å­˜å‚¨ä¸€äº›ä¸å½±å“ç»„ä»¶è§†å›¾è¾“å‡ºä¿¡æ¯çš„å®Œç¾é€‰æ‹©ã€‚

ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– `ref.current`ã€‚

#### ç¤ºä¾‹

å­˜å‚¨å®šæ—¶å™¨ ID

```js
const intervalRef = useRef(null);
// å¼€å¯å®šæ—¶å™¨
function handleStartClick() {
  const intervalId = setInterval(() => {
    // ...
  }, 1000);
  intervalRef.current = intervalId;
}

// æ¸…é™¤å®šæ—¶å™¨
function handleStopClick() {
  const intervalId = intervalRef.current;
  clearInterval(intervalId);
}
```

#### ref æ“ä½œ DOM

```js
export default function Form() {
  const inputRef = useRef(null);

  function handleClick() {
    inputRef.current.focus();
  }

  return (
    <>
      <input ref={inputRef} />
      <button onClick={handleClick}>èšç„¦è¾“å…¥æ¡†</button>
    </>
  );
}
```

#### é¿å…é‡å¤åˆ›å»º ref

```js
function Video() {
  const playerRef = useRef(null);
  if (playerRef.current === null) {
    playerRef.current = new VideoPlayer();
  }
  // ...
}
```

#### è·å–è‡ªå®šä¹‰ç»„ä»¶çš„ ref

```js
const inputRef = useRef(null);

return <MyInput ref={inputRef} />;

export default function MyInput({ value, onChange, ref }) {
  return <input value={value} onChange={onChange} ref={ref} />;
}
```

#### è·å–è‡ªå®šä¹‰ç»„ä»¶å®ä¾‹

```js
const inputRef = useRef(null);

return <MyInput ref={inputRef} />;

export default function MyInput({ value, onChange, ref }) {
  const [instance, setInstance] = useState(componentInstance);
  useImperativeHandle(ref, () => instance, [instance]); // è‡ªå®šä¹‰ç”± ref æš´éœ²å‡ºæ¥çš„å¥æŸ„

  return <input value={value} onChange={onChange} ref={ref} />;
}
```

### `useImperativeHandle`

å®ƒèƒ½è®©ä½ è‡ªå®šä¹‰ç”± `ref` æš´éœ²å‡ºæ¥çš„å¥æŸ„ã€‚

```js
useImperativeHandle(ref, createHandle, dependencies?)
```

#### ç¤ºä¾‹

ä»…æš´éœ² `focus` å’Œ `scrollIntoView` æ–¹æ³•ï¼Œè€Œä¸æ˜¯æš´éœ²æ•´ä¸ª `inputRef` å¯¹è±¡ã€‚

```js
export default function MyInput({ ref }) {
  const inputRef = useRef(null);

  useImperativeHandle(
    ref,
    () => {
      return {
        focus() {
          inputRef.current.focus();
        },
        scrollIntoView() {
          inputRef.current.scrollIntoView();
        },
      };
    },
    []
  );

  return <input ref={inputRef} />;
}
```

### `useEffect`

Effect å…è®¸ç»„ä»¶ è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿå¹¶ä¸ä¹‹åŒæ­¥ã€‚è¿™åŒ…æ‹¬å¤„ç†ç½‘ç»œã€æµè§ˆå™¨ã€DOMã€åŠ¨ç”»ã€ä½¿ç”¨ä¸åŒ UI åº“ç¼–å†™çš„å°éƒ¨ä»¶ä»¥åŠå…¶ä»–é React ä»£ç ã€‚

```js
useEffect(setup, dependencies?)
```

#### ç¤ºä¾‹

```js
export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState("https://localhost:1234");

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [serverUrl, roomId]);

  return <h1>Welcome to the {roomId} room!</h1>;
}
```

#### å‚æ•°

- `setup`ï¼šå¤„ç† Effect çš„å‡½æ•°ã€‚setup å‡½æ•°é€‰æ‹©æ€§è¿”å›ä¸€ä¸ª **æ¸…ç†ï¼ˆcleanupï¼‰ å‡½æ•°**ã€‚å½“ç»„ä»¶è¢«æ·»åŠ åˆ° DOM çš„æ—¶å€™ï¼ŒReact å°†è¿è¡Œ setup å‡½æ•°ã€‚åœ¨æ¯æ¬¡ä¾èµ–é¡¹å˜æ›´é‡æ–°æ¸²æŸ“åï¼ŒReact å°†é¦–å…ˆä½¿ç”¨æ—§å€¼è¿è¡Œ cleanup å‡½æ•°ï¼ˆå¦‚æœä½ æä¾›äº†è¯¥å‡½æ•°ï¼‰ï¼Œç„¶åä½¿ç”¨æ–°å€¼è¿è¡Œ setup å‡½æ•°ã€‚åœ¨ç»„ä»¶ä» DOM ä¸­ç§»é™¤åï¼ŒReact å°†æœ€åä¸€æ¬¡è¿è¡Œ cleanup å‡½æ•°ã€‚
- `dependencies`ï¼š`setup` ä»£ç ä¸­å¼•ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ã€‚å“åº”å¼å€¼åŒ…æ‹¬ propsã€state ä»¥åŠæ‰€æœ‰ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœçœç•¥æ­¤å‚æ•°ï¼Œåˆ™åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼Œå°†é‡æ–°è¿è¡Œ Effect å‡½æ•°ã€‚å¦‚æœåªéœ€è¦è¿è¡Œä¸€æ¬¡ Effect å‡½æ•°ï¼Œåˆ™å¯ä»¥ä¼ å…¥ç©ºæ•°ç»„ `[]`ã€‚

#### è¿”å›å€¼

è¿”å› `undefined`ã€‚

#### æ³¨æ„

- å¦‚æœä½  æ²¡æœ‰æ‰“ç®—ä¸æŸä¸ªå¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦ Effectã€‚
- Effect åªåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä¸ä¼šè¿è¡Œã€‚
- ä½ çš„ `cleanup` é€»è¾‘åº”è¯¥ä¸ `setup` é€»è¾‘â€œå¯¹ç§°â€ï¼Œå¹¶ä¸”åº”è¯¥åœæ­¢æˆ–æ’¤é”€ä»»ä½• `setup` åšçš„äº‹æƒ…ã€‚

#### æ¡ˆä¾‹

1ï¸âƒ£ è¿æ¥æœåŠ¡å™¨

```js
useEffect(() => {
  const connection = createConnection(serverUrl, roomId);
  connection.connect();
  return () => {
    connection.disconnect();
  };
}, [roomId, serverUrl]);
```

2ï¸âƒ£ ç›‘å¬æµè§ˆå™¨äº‹ä»¶

```js
useEffect(() => {
  function handleMove(e) {
    setPosition({ x: e.clientX, y: e.clientY });
  }
  window.addEventListener("pointermove", handleMove);
  return () => {
    window.removeEventListener("pointermove", handleMove);
  };
}, []);
```

3ï¸âƒ£ è§¦å‘åŠ¨ç”»æ•ˆæœ

```js
useEffect(() => {
  const animation = new FadeInAnimation(ref.current);
  animation.start(1000);
  return () => {
    animation.stop();
  };
}, []);
```

4ï¸âƒ£ æ§åˆ¶æ¨¡æ€æ¡†

```js
useEffect(() => {
  if (!isOpen) {
    return;
  }
  const dialog = ref.current;
  dialog.showModal();
  return () => {
    dialog.close();
  };
}, [isOpen]);
```

5ï¸âƒ£ è·Ÿè¸ªå…ƒç´ å¯è§æ€§

```js
useEffect(() => {
  const div = ref.current;
  const observer = new IntersectionObserver(
    (entries) => {
      const entry = entries[0];
      if (entry.isIntersecting) {
        document.body.style.backgroundColor = "black";
        document.body.style.color = "white";
      } else {
        document.body.style.backgroundColor = "white";
        document.body.style.color = "black";
      }
    },
    {
      threshold: 1.0,
    }
  );
  observer.observe(div);
  return () => {
    observer.disconnect();
  };
}, []);
```

#### åœ¨è‡ªå®šä¹‰ Hook ä¸­å°è£… Effect

Effect æ˜¯ä¸€ç§ è„±å›´æœºåˆ¶ï¼šå½“ä½ éœ€è¦â€œèµ°å‡º React ä¹‹å¤–â€æˆ–è€…å½“ä½ çš„ä½¿ç”¨åœºæ™¯æ²¡æœ‰æ›´å¥½çš„å†…ç½®è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœä½ å‘ç°è‡ªå·±ç»å¸¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ Effectï¼Œé‚£ä¹ˆè¿™é€šå¸¸è¡¨æ˜ä½ éœ€è¦ä¸ºç»„ä»¶æ‰€ä¾èµ–çš„é€šç”¨è¡Œä¸ºæå–ä¸€äº› è‡ªå®šä¹‰ Hookã€‚

ä¾‹å¦‚ï¼Œè¿™ä¸ª useChatRoom è‡ªå®šä¹‰ Hook æŠŠ Effect çš„é€»è¾‘â€œéšè—â€åœ¨ä¸€ä¸ªæ›´å…·å£°æ˜æ€§çš„ API ä¹‹åï¼š

```js
function useChatRoom({ serverUrl, roomId }) {
  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId,
    };
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]);
}

// ä½ å¯ä»¥åƒè¿™æ ·ä»ä»»ä½•ç»„ä»¶ä½¿ç”¨å®ƒ
function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState("https://localhost:1234");

  useChatRoom({ roomId, serverUrl });
  // ...
}
```

```js
// ç›‘å¬çª—å£äº‹ä»¶
export function useWindowListener(eventType, listener) {
  useEffect(() => {
    window.addEventListener(eventType, listener);
    return () => {
      window.removeEventListener(eventType, listener);
    };
  }, [eventType, listener]);
}

// è·Ÿè¸ªå…ƒç´ å¯è§æ€§
export function useIntersectionObserver(ref) {
  const [isIntersecting, setIsIntersecting] = useState(false);

  useEffect(() => {
    const div = ref.current;
    const observer = new IntersectionObserver(
      (entries) => {
        const entry = entries[0];
        setIsIntersecting(entry.isIntersecting);
      },
      {
        threshold: 1.0,
      }
    );
    observer.observe(div);
    return () => {
      observer.disconnect();
    };
  }, [ref]);

  return isIntersecting;
}
```

#### é¿å…ç«äº‰æ¡ä»¶çš„å½±å“

æ³¨æ„ï¼Œ`ignore` å˜é‡è¢«åˆå§‹åŒ–ä¸º `false`ï¼Œå¹¶ä¸”åœ¨ `cleanup` ä¸­è¢«è®¾ç½®ä¸º `true`ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ ä½ çš„ä»£ç ä¸ä¼šå—åˆ°â€œç«äº‰æ¡ä»¶â€çš„å½±å“ï¼šç½‘ç»œå“åº”å¯èƒ½ä¼šä»¥ä¸ä½ å‘é€çš„ä¸åŒçš„é¡ºåºåˆ°è¾¾ã€‚

```js
export default function Page() {
  const [person, setPerson] = useState("Alice");
  const [bio, setBio] = useState(null);
  useEffect(() => {
    let ignore = false;
    setBio(null);
    fetchBio(person).then((result) => {
      if (!ignore) {
        setBio(result);
      }
    });
    return () => {
      ignore = true;
    };
  }, [person]);

  return <>...</>;
}
```

#### æŒ‡å®šå“åº”å¼ä¾èµ–é¡¹

**ä½ æ— æ³•â€œé€‰æ‹©â€ Effect çš„ä¾èµ–é¡¹**ã€‚Effect ä»£ç ä¸­ä½¿ç”¨çš„æ¯ä¸ª **å“åº”å¼å€¼** éƒ½å¿…é¡»å£°æ˜ä¸ºä¾èµ–é¡¹ã€‚ä½ çš„ Effect ä¾èµ–åˆ—è¡¨æ˜¯ç”±å‘¨å›´ä»£ç å†³å®šçš„ï¼š

#### åˆ é™¤ä¸å¿…è¦çš„å¯¹è±¡ä¾èµ–é¡¹

å¦‚æœä½ çš„ Effect ä¾èµ–äºåœ¨æ¸²æŸ“æœŸé—´åˆ›å»ºçš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œåˆ™å®ƒå¯èƒ½ä¼šé¢‘ç¹è¿è¡Œã€‚ä¾‹å¦‚ï¼Œæ­¤ Effect åœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½é‡æ–°è¿æ¥ï¼Œå› ä¸º **options å¯¹è±¡æ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒ**

```js
function ChatRoom({ roomId }) {
  const options = {
    // ğŸš© è¿™ä¸ªå¯¹è±¡åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½æ˜¯ä»å¤´åˆ›å»ºçš„
    serverUrl: serverUrl,
    roomId: roomId,
  };

  useEffect(() => {
    const connection = createConnection(options); // å®ƒåœ¨ Effect å†…éƒ¨ä½¿ç”¨
    connection.connect();
    return () => connection.disconnect();
  }, [options]); // ğŸš© å› æ­¤ï¼Œè¿™äº›ä¾èµ–åœ¨é‡æ–°æ¸²æŸ“æ—¶æ€»æ˜¯ä¸åŒçš„
  // ...
}
```

é¿å…ä½¿ç”¨æ¸²æŸ“æœŸé—´åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºä¾èµ–é¡¹ã€‚ç›¸åï¼Œåœ¨ Effect å†…éƒ¨åˆ›å»ºå¯¹è±¡

```js
useEffect(() => {
  const options = {
    serverUrl: serverUrl,
    roomId: roomId,
  };
  const connection = createConnection(options);
  connection.connect();
  return () => connection.disconnect();
}, [roomId]);
```

æˆ–è€…ä½¿ç”¨ `useMemo` æ¥ç¼“å­˜å¯¹è±¡

```js
const options = useMemo(() => {
  return {
    serverUrl: serverUrl,
    roomId: roomId,
  };
}, [roomId]);

useEffect(() => {
  const connection = createConnection(options);
  connection.connect();
  return () => connection.disconnect();
}, [options]); // âœ… åªé‡æ–°è¿æ¥ä¸€æ¬¡
```

### `useLayoutEffect`

`useLayoutEffect` ä¸ `useEffect` éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒä¼šåœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ä¹‹å‰è§¦å‘ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è¯»å– DOM å¹¶æµ‹é‡å®ƒã€‚å¦‚æœä½ éœ€è¦åšä¸ DOM ç›¸å…³çš„æ“ä½œï¼Œè¯·ä½¿ç”¨ `useLayoutEffect` è€Œä¸æ˜¯ `useEffect`ã€‚

```js
useLayoutEffect(setup, dependencies?)
```

#### ç¤ºä¾‹

æƒ³è±¡ä¸€ä¸‹æ‚¬åœæ—¶å‡ºç°åœ¨æŸä¸ªå…ƒç´ æ—è¾¹çš„ tooltipã€‚å¦‚æœæœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œtooltip åº”è¯¥å‡ºç°åœ¨å…ƒç´ çš„ä¸Šæ–¹ï¼Œä½†æ˜¯å¦‚æœä¸åˆé€‚ï¼Œå®ƒåº”è¯¥å‡ºç°åœ¨ä¸‹é¢ã€‚ä¸ºäº†è®© tooltip æ¸²æŸ“åœ¨æœ€ç»ˆæ­£ç¡®çš„ä½ç½®ï¼Œä½ éœ€è¦çŸ¥é“å®ƒçš„é«˜åº¦ï¼ˆå³å®ƒæ˜¯å¦é€‚åˆæ”¾åœ¨é¡¶éƒ¨ï¼‰ã€‚

```js
function Tooltip() {
  const ref = useRef(null);
  const [tooltipHeight, setTooltipHeight] = useState(0); // ä½ è¿˜ä¸çŸ¥é“çœŸæ­£çš„é«˜åº¦

  useLayoutEffect(() => {
    const { height } = ref.current.getBoundingClientRect();
    setTooltipHeight(height); // ç°åœ¨é‡æ–°æ¸²æŸ“ï¼Œä½ çŸ¥é“äº†çœŸå®çš„é«˜åº¦
  }, []);

  // ... åœ¨ä¸‹æ–¹çš„æ¸²æŸ“é€»è¾‘ä¸­ä½¿ç”¨ tooltipHeight ...
}
```

ä¸‹é¢æ˜¯è¿™å¦‚ä½•ä¸€æ­¥æ­¥å·¥ä½œçš„

- Tooltip ä½¿ç”¨åˆå§‹å€¼ `tooltipHeight = 0` è¿›è¡Œæ¸²æŸ“ï¼ˆå› æ­¤ tooltip å¯èƒ½è¢«é”™è¯¯åœ°æ”¾ç½®ï¼‰ã€‚
- React å°†å®ƒæ”¾åœ¨ DOM ä¸­ï¼Œç„¶åè¿è¡Œ `useLayoutEffect` ä¸­çš„ä»£ç ã€‚
- `useLayoutEffect` **æµ‹é‡** äº† tooltip å†…å®¹çš„é«˜åº¦ï¼Œå¹¶ç«‹å³è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
- ä½¿ç”¨å®é™…çš„ `tooltipHeight` å†æ¬¡æ¸²æŸ“ Tooltipï¼ˆè¿™æ · tooltip çš„ä½ç½®å°±æ­£ç¡®äº†ï¼‰ã€‚
- React åœ¨ DOM ä¸­å¯¹å®ƒè¿›è¡Œæ›´æ–°ï¼Œæµè§ˆå™¨æœ€ç»ˆæ˜¾ç¤ºå‡º tooltipã€‚

::: note
æ³¨æ„ï¼Œå³ä½¿ Tooltip ç»„ä»¶éœ€è¦ä¸¤æ¬¡æ¸²æŸ“ï¼ˆé¦–å…ˆï¼Œä½¿ç”¨åˆå§‹å€¼ä¸º 0 çš„ `tooltipHeight` æ¸²æŸ“ï¼Œç„¶åä½¿ç”¨å®é™…æµ‹é‡çš„é«˜åº¦æ¸²æŸ“ï¼‰ï¼Œä½ ä¹Ÿåªèƒ½çœ‹åˆ°æœ€ç»ˆç»“æœã€‚
:::

React ä¿è¯äº† `useLayoutEffect` ä¸­çš„ä»£ç ä»¥åŠå…¶ä¸­ä»»ä½•è®¡åˆ’çš„çŠ¶æ€æ›´æ–°éƒ½ä¼šåœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ä¹‹å‰å¾—åˆ°å¤„ç†ã€‚è¿™æ ·ä½ å°±å¯ä»¥æ¸²æŸ“ tooltipï¼Œæµ‹é‡å®ƒï¼Œç„¶ååœ¨ç”¨æˆ·æ²¡æœ‰æ³¨æ„åˆ°ç¬¬ä¸€ä¸ªé¢å¤–æ¸²æŸ“çš„æƒ…å†µä¸‹å†æ¬¡é‡æ–°æ¸²æŸ“ã€‚æ¢å¥è¯è¯´ï¼Œ`useLayoutEffect` é˜»å¡äº†æµè§ˆå™¨çš„ç»˜åˆ¶ã€‚

### `useInsertionEffect`

åœ¨ React å¯¹ DOM è¿›è¡Œæ›´æ”¹ä¹‹å‰è§¦å‘ï¼Œåº“å¯ä»¥åœ¨æ­¤å¤„æ’å…¥åŠ¨æ€ CSS

`useInsertionEffect` æ˜¯ä¸º CSS-in-JS åº“çš„ä½œè€…ç‰¹æ„æ‰“é€ çš„ã€‚é™¤éä½ æ­£åœ¨ä½¿ç”¨ CSS-in-JS åº“å¹¶ä¸”éœ€è¦æ³¨å…¥æ ·å¼ï¼Œå¦åˆ™ä½ åº”è¯¥ä½¿ç”¨ `useEffect` æˆ–è€… `useLayoutEffect`ã€‚

### `useMemo`

ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ä»£ä»·æ˜‚è´µçš„è®¡ç®—ç»“æœ

```js
const cachedValue = useMemo(calculateValue, dependencies);
```

#### å‚æ•°

- `calculateValue`ï¼šè®¡ç®—å€¼çš„å‡½æ•°ã€‚
- `dependencies`ï¼šè®¡ç®—å€¼çš„ä¾èµ–é¡¹ã€‚

#### è¿”å›å€¼

è¿”å›è®¡ç®—å€¼çš„ç¼“å­˜ç»“æœã€‚

#### ç¤ºä¾‹

```js
export default function TodoList({ todos, tab, theme }) {
  const visibleTodos = useMemo(() => filterTodos(todos, tab), [todos, tab]);
  // ...
}
```

#### è·³è¿‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact ä¼šé€’å½’åœ°é‡æ–°æ¸²æŸ“å®ƒçš„æ‰€æœ‰å­ç»„ä»¶ã€‚ä½¿ç”¨ `memo` å¯ä»¥è·³è¿‡å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

å½“å®ƒçš„ `props` è·Ÿä¸Šä¸€æ¬¡æ¸²æŸ“ç›¸åŒçš„æ—¶å€™å®ƒå°±ä¼šè·³è¿‡æœ¬æ¬¡æ¸²æŸ“

```js
import { memo } from "react";

const List = memo(function List({ items }) {
  // ...
});
```

#### è®°å¿†ä¸€ä¸ªå‡½æ•°

å‡è®¾ Form ç»„ä»¶è¢«åŒ…è£¹åœ¨ `memo` ä¸­ï¼Œä½ æƒ³å°†ä¸€ä¸ªå‡½æ•°ä½œä¸º props ä¼ é€’ç»™å®ƒï¼š

```js
export default function ProductPage({ productId, referrer }) {
  function handleSubmit(orderDetails) {
    post("/product/" + productId + "/buy", {
      referrer,
      orderDetails,
    });
  }

  return <Form onSubmit={handleSubmit} />;
}
```

æ­£å¦‚ `{}` æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸åŒçš„å¯¹è±¡ä¸€æ ·ï¼Œåƒ `function() {}` è¿™æ ·çš„å‡½æ•°å£°æ˜å’Œåƒ `() => {}` è¿™æ ·çš„è¡¨è¾¾å¼åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª ä¸åŒ çš„å‡½æ•°ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ä¸æ˜¯é—®é¢˜ã€‚è¿™ä¸æ˜¯å¯ä»¥é¿å…çš„äº‹æƒ…ï¼ä½†æ˜¯ï¼Œå¦‚æœ Form ç»„ä»¶è¢«è®°å¿†äº†ï¼Œå¤§æ¦‚ä½ æƒ³åœ¨æ²¡æœ‰ props æ”¹å˜æ—¶è·³è¿‡å®ƒçš„é‡æ–°æ¸²æŸ“ã€‚æ€»æ˜¯ ä¸åŒçš„ props ä¼šç ´åä½ çš„è®°å¿†åŒ–ã€‚

è¦ä½¿ç”¨ useMemo è®°å¿†å‡½æ•°ï¼Œä½ çš„è®¡ç®—å‡½æ•°å¿…é¡»è¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼š

```js
const handleSubmit = useMemo(() => {
  return (orderDetails) => {
    post("/product/" + productId + "/buy", {
      referrer,
      orderDetails,
    });
  };
}, [productId, referrer]);
```

è¿™å¤ªç¬¨æ‹™äº†ï¼Œå¯ä»¥ä½¿ç”¨ `useCallback` æ¥è®°å¿†å‡½æ•°

```js
const handleSubmit = useCallback(
  (orderDetails) => {
    post("/product/" + productId + "/buy", {
      referrer,
      orderDetails,
    });
  },
  [productId, referrer]
);
```

### `useCallback`

å…è®¸ä½ åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°

```js
const cachedFn = useCallback(fn, dependencies);
```

#### ç¤ºä¾‹

```js
const handleSubmit = useCallback(
  (orderDetails) => {
    post("/product/" + productId + "/buy", {
      referrer,
      orderDetails,
    });
  },
  [productId, referrer]
);
```
