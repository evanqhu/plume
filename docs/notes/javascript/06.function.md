---
title: å‡½æ•°
createTime: 2025/04/21 16:12:11
permalink: /javascript/yp26tscp/
---

## å‡½æ•°åŸºç¡€

#### å£°æ˜å‡½æ•°

```js
// 1. è‡ªå®šä¹‰å‡½æ•° (å‘½åå‡½æ•°)
function fn() {}
// 2. å‡½æ•°è¡¨è¾¾å¼ (åŒ¿åå‡½æ•°)
const fun = function () {};
const fun = () => {};
// 3. åˆ©ç”¨ new Function('å‚æ•°1', 'å‚æ•°2', 'å‡½æ•°ä½“')
const f = new Function("a", "b", "console.log(a + b)");
```

#### è°ƒç”¨å‡½æ•°

```js
// 1.è°ƒç”¨æ™®é€šå‡½æ•° fn(); fn.call() fn.apply()
// 2.å¯¹è±¡çš„æ–¹æ³•ï¼ŒObject.keyï¼Œvalue æ˜¯å‡½æ•°ï¼Œåˆ™è¢«è°ƒç”¨äº†
// 3.æ„é€ å‡½æ•° new
// 4.ç»‘å®šäº‹ä»¶å‡½æ•°ï¼Œæ‰§è¡Œäº‹ä»¶å³å¯ (å›è°ƒå‡½æ•°)
// 5.å®šæ—¶å™¨å‡½æ•° (å›è°ƒå‡½æ•°)
// 6.ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè‡ªåŠ¨è°ƒç”¨ ()()ï¼Œå‰ä¸€ä¸ª()é‡Œé¢å†™ä¸€ä¸ªå‡½æ•°ï¼›åä¸€ä¸ª()è¡¨ç¤ºç«‹å³æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¯ä¼ å‚
void (function () {
  console.log("...");
})();
```

- å¦‚æœå®å‚ä¸ªæ•°å¤§äºå½¢å‚ä¸ªæ•°ï¼Œä¼šå–å½¢å‚çš„ä¸ªæ•°ï¼›å¦‚æœå®å‚ä¸ªæ•°å°äºå½¢å‚ä¸ªæ•°ï¼Œç¼ºå°‘çš„å®å‚ä¼šè¢«å½“ä½œ `undefined`
- `return` **åªèƒ½è¿”å›ä¸€ä¸ªå€¼**ï¼Œè¿”å›æœ€åä¸€ä¸ªå€¼ï¼›æ²¡æœ‰ `return` æ—¶è¿”å› `undefined`
- è®¿é—®æ²¡æœ‰æ‹¬å· `()` çš„å‡½æ•°å°†è¿”å›å‡½æ•°å®šä¹‰
- **arguments å¯¹è±¡**çš„ä½¿ç”¨
  - ä¸ç¡®å®šæœ‰å¤šå°‘å‚æ•°ä¼ é€’æ—¶ï¼Œç”¨ `arguments` å¯¹è±¡è·å–ï¼Œå­˜å–äº†ä¼ é€’çš„æ‰€æœ‰å®å‚
  - ä»¥ä¼ªæ•°ç»„å½¢å¼å±•ç¤ºï¼šå…·æœ‰ `length` å±æ€§ï¼›æŒ‰ç…§ç´¢å¼•çš„æ–¹å¼å­˜å‚¨ï¼›æ²¡æœ‰çœŸæ­£æ•°ç»„çš„ä¸€äº›æ–¹æ³•;
  - `arguments` æ— éœ€æŒ‡å‡ºå‚æ•°åå°±å¯è®¿é—®
  - `arguments` èº«ä¸Šæœ‰ä¸€ä¸ªå±æ€§ `callee`ï¼Œå­˜å‚¨çš„æ˜¯è¿™ä¸ªå‡½æ•°æœ¬èº«

```js
// args å¯ä»¥æ¢æˆå…¶å®ƒåå­—ï¼Œå¦‚ demo,å®ƒå±äºæ˜¯å‰©ä½™å‚æ•°
// arguments ä¸èƒ½æ¢
function fn(...args) {
  console.log("ğŸš€ğŸš€ğŸš€  args: ", args); // [ 'a', 'b' ]
  console.log("ğŸš€ğŸš€ğŸš€  arguments: ", arguments); // [Arguments] { '0': 'a', '1': 'b' }
}
fn("a", "b");

// å‰©ä½™å‚æ•°
function sum(first, ...args) {
  console.log(first); // 10
  console.log(args); // [20, 30]
}
sum(10, 20, 30);
```

**this æŒ‡å‘**ï¼šå‡½æ•°çš„ä¸åŒè°ƒç”¨æ–¹å¼å†³å®šäº† this çš„æŒ‡å‘ä¸åŒ

- å¯¹è±¡çš„æ–¹æ³• this æŒ‡å‘çš„æ˜¯å¯¹è±¡ï¼›
- æ„é€ å‡½æ•°å’ŒåŸå‹å¯¹è±¡çš„ this éƒ½æŒ‡å‘åˆ›å»ºçš„å®ä¾‹å¯¹è±¡ï¼›
- ç»‘å®šäº‹ä»¶å‡½æ•° this æŒ‡å‘çš„æ˜¯å‡½æ•°çš„è°ƒç”¨è€… btn è¿™ä¸ªæŒ‰é’®å¯¹è±¡ï¼›
- å®šæ—¶å™¨å‡½æ•° this æŒ‡å‘çš„ä¹Ÿæ˜¯ windowï¼›
- ç«‹å³æ‰§è¡Œå‡½æ•° this è¿˜æ˜¯æŒ‡å‘ windowï¼›
- æ™®é€šå‡½æ•° this æŒ‡å‘ windowã€‚

#### æ”¹å˜ this æŒ‡å‘

1ï¸âƒ£ `call()`

```js
const p = {}; // ä¸€ä¸ªå¯¹è±¡
function fn(a, b) {} // ä¸€ä¸ªå‡½æ•°

// 1.call()
fn.call(p, a, b); // æŠŠ this æŒ‡å‘å¯¹è±¡ pï¼›å®å‚ä¾æ¬¡ä¼ å…¥
function greet(greeting, punctuation) {
  console.log(greeting + ", " + this.name + punctuation);
}
const person = { name: "Alice" };
greet.call(person, "Hello", "!"); // Hello, Alice!
```

2ï¸âƒ£ `apply()`

```js
fn.apply(p, [a, b]); // æŠŠ this æŒ‡å‘å¯¹è±¡ pï¼›å®å‚ä»¥æ•°ç»„æˆ–ä¼ªæ•°ç»„å½¢å¼ä¼ å…¥
function greet(greeting, punctuation) {
  console.log(greeting + ", " + this.name + punctuation);
}
const person = { name: "Alice" };
greet.apply(person, ["Hello", "!"]); // Hello, Alice!

// åˆ©ç”¨ apply å€ŸåŠ©äºæ•°å­¦å†…ç½®å¯¹è±¡çš„æ–¹æ³•æ±‚æ•°ç»„æœ€å¤§å€¼
const max = Math.max.apply(Math, arr);
```

3ï¸âƒ£ `bind()`

```js
// è¯¥æ–¹æ³•ä¸ä¼šè°ƒç”¨åŸæ¥çš„å‡½æ•°ï¼Œè¿”å›çš„æ˜¯åŸå‡½æ•°æ”¹å˜ this ä¹‹åäº§ç”Ÿçš„æ–°å‡½æ•°
const fn2 = fn.bind(p, 1, 2);
// å¯ç”¨åœ¨ setTimeout é‡Œé¢ï¼Œç»‘å®šå›è°ƒå‡½æ•°ï¼Œæ”¹å˜å…¶ this æŒ‡å‘
```

## ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°æ˜¯ç”¨æ¥ç®€åŒ–å‡½æ•°å®šä¹‰è¯­æ³•ï¼›å¯¹äºç®­å¤´å‡½æ•°ï¼Œ`this` å…³é”®å­—å§‹ç»ˆè¡¨ç¤ºå®šä¹‰ç®­å¤´å‡½æ•°çš„å¯¹è±¡

```js
// æ™®é€šå‡½æ•°
const fun = function () {};

// ç®­å¤´å‡½æ•°
const fn = () => {};
// å¦‚æœå‡½æ•°ä½“ä¸­åªæœ‰ä¸€å¥ä»£ç ï¼Œå¹¶ä¸”ä»£ç çš„æ‰§è¡Œç»“æœå°±æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼Œå‡½æ•°ä½“å¤§æ‹¬å·å¯ä»¥çœç•¥
const sum = (n1, n2) => n1 + n2;
// å¦‚æœå½¢å‚åªæœ‰ä¸€ä¸ªï¼Œå½¢å‚å¤–ä¾§çš„å°æ‹¬å·ä¹Ÿæ˜¯å¯ä»¥çœç•¥
const fn = (v) => alert(v);

const age = 100;
const obj = {
  age: 20,
  say: () => {
    alert(this.age);
  },
};
obj.say(); // è¾“å‡º 100ï¼ˆå¯¹è±¡ä¸äº§ç”Ÿä½œç”¨åŸŸï¼Œç®­å¤´å‡½æ•° say å®é™…ä¸Šè¢«å®šä¹‰åœ¨ window ä¸­ï¼‰
```

## é—­åŒ…

**é«˜é˜¶å‡½æ•°å®šä¹‰ï¼š**å¯¹å…¶ä»–å‡½æ•°è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶**å‡½æ•°ä½œä¸ºå‚æ•°**æˆ–è€…å°†**å‡½æ•°ä½œä¸ºè¿”å›å€¼**è¾“å‡ºï¼›å¦‚å›è°ƒå‡½æ•°ï¼Œå®ƒå°±æ˜¯å°† `callback` ä½œä¸ºå‚æ•°ï¼Œåœ¨é«˜é˜¶å‡½æ•°çš„å‡½æ•°ä½“å†…æœ€åä¸€è¡Œæ‰§è¡Œã€‚

#### é—­åŒ…

æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°

```js
function fn() {
  const num = 10;
  function fun() {
    console.log(num); // fun å‡½æ•°è®¿é—®äº†å¤–éƒ¨å‡½æ•° fn ä½œç”¨åŸŸå†…çš„å˜é‡
  }
  fun();
}
fn(); // fn() ä¸ºé—­åŒ…å‡½æ•°ï¼›è¢«è®¿é—®çš„å˜é‡æ‰€åœ¨çš„å‡½æ•°æ˜¯é—­åŒ…å‡½æ•°
```

é—­åŒ…å»¶ä¼¸äº†å˜é‡çš„ä½œç”¨èŒƒå›´ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ä»å¤–éƒ¨ä½œç”¨åŸŸè®¿é—®å†…éƒ¨çš„å±€éƒ¨å˜é‡

```js
function fn() {
  const num = 10;
  function fun() {
    console.log(num);
  }
  return fun; // è¿”å›ä¸€ä¸ªå‡½æ•° ï¼ï¼ï¼
}
const f = fn(); // è°ƒç”¨ f å°±å¯ä»¥æ‹¿åˆ° num çš„å€¼ï¼Œç›¸å½“äºä»å‡½æ•°å¤–éƒ¨è·å–åˆ°å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡

// å¯ç®€å†™
function fn() {
  const num = 10;
  return () => console.log(num); // ç›´æ¥è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°æˆ–ç®­å¤´å‡½æ•°
}
// ä½¿ç”¨ fn()() å³å¯æ‰“å°å‡º num çš„å€¼ï¼Œä»å¤–éƒ¨è®¿é—®å‡½æ•°ä½œç”¨åŸŸçš„å˜é‡
```

#### é—­åŒ…åº”ç”¨æ¡ˆä¾‹

**æ•°æ®ç§æœ‰åŒ–**ï¼šcreateCounter è¿”å›äº†ä¸€ä¸ªåŒ…å«é—­åŒ…çš„å¯¹è±¡ï¼Œè¿™äº›é—­åŒ…å¯ä»¥è®¿é—® count å˜é‡ï¼Œä½† count å˜é‡æœ¬èº«æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚

```js
function createCounter() {
  let count = 0;

  return {
    increment: () => {
      count++;
      return count;
    },
    decrement: () => {
      count--;
      return count;
    },
  };
}

const counter = createCounter();
console.log(counter.increment()); // è¾“å‡ºï¼š1
console.log(counter.increment()); // è¾“å‡ºï¼š2
console.log(counter.decrement()); // è¾“å‡ºï¼š1
```

**å¾ªç¯æ³¨å†Œç‚¹å‡»äº‹ä»¶ï¼ˆç‚¹å‡»äº‹ä»¶æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼‰**

ä»¥ä¸‹ä»£ç ç‚¹å‡»ä»»æ„ `li` åªä¼šè¾“å‡º 4 ã€‚åŸå› å¦‚ä¸‹ï¼š
ç‚¹å‡»äº‹ä»¶æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œåªæœ‰ç‚¹å‡»äº†æ‰ä¼šæ‰§è¡Œå‡½æ•°ï¼›ä½† for å¾ªç¯æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œï¼Œç„¶åå°±ç»™ 4 ä¸ª `li` æ³¨å†Œäº†ç‚¹å‡»äº‹ä»¶å‡½æ•°ï¼Œè¿™æ—¶ `i` çš„å€¼å·²ç»å˜ä¸º 4ï¼Œæ‰€ä»¥ç‚¹å‡»ä»»æ„ `li`ï¼Œæ‰§è¡Œå…¶ç‚¹å‡»äº‹ä»¶å‡½æ•°ï¼Œè¾“å‡ºçš„éƒ½æ˜¯ 4ã€‚

```js
// ç‚¹å‡» li è¾“å‡ºå…¶ç´¢å¼•å·ï¼ˆé”™è¯¯å†™æ³• varï¼‰
const lis = document.querySelector(".nav").querySelectorAll("li"); // 4 ä¸ª li
for (var i = 0; i < lis.length; i++) {
  // å¾ªç¯æ³¨å†Œç‚¹å‡»äº‹ä»¶
  lis[i].onclick = function () {
    console.log(i); // è¾“å‡ºç´¢å¼•å·
  };
}

// æ­£ç¡®å†™æ³•1ï¼šlet
const lis = document.querySelector(".nav").querySelectorAll("li"); // 4 ä¸ª li
for (let i = 0; i < lis.length; i++) {
  // å¾ªç¯æ³¨å†Œç‚¹å‡»äº‹ä»¶
  lis[i].onclick = function () {
    console.log(i); // è¾“å‡ºç´¢å¼•å·
  };
}

// æ­£ç¡®å†™æ³•2ï¼šåŠ¨æ€æ·»åŠ å±æ€§
for (var i = 0; i < lis.length; i++) {
  lis[i].index = i; // ä¿å­˜ li çš„ç´¢å¼•å·
  lis[i].onclick = function () {
    console.log(this.index); // è¾“å‡ºç´¢å¼•å·
  };
}

// æ­£ç¡®å†™æ³•3ï¼šé—­åŒ…
for (var i = 0; i < lis.length; i++) {
  // åˆ©ç”¨ for å¾ªç¯åˆ›å»ºäº† 4 ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°
  // ç«‹å³æ‰§è¡Œå‡½æ•°ä¹Ÿç§°ä¸ºå°é—­åŒ…ï¼Œå› ä¸ºç«‹å³æ‰§è¡Œå‡½æ•°é‡Œé¢çš„ä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨å®ƒçš„ i è¿™ä¸ªå˜é‡
  (function (i) {
    // i è¡¨ç¤ºæ¥æ”¶çš„å‚æ•°
    lis[i].onclick = function () {
      console.log(i); // ä½¿ç”¨äº†ç«‹å³æ‰§è¡Œå‡½æ•°çš„ i è¿™ä¸ªå˜é‡ï¼ˆé—­åŒ…ï¼‰
    };
  })(i); // i è¡¨ç¤ºä¼ å…¥çš„å‚æ•°
}
```

**å®šæ—¶å™¨ä¸­çš„é—­åŒ…ï¼ˆå®šæ—¶å™¨æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼‰**

```js
// å†™æ³•1ï¼šé—­åŒ…
for (let i = 0; i < lis.length; i++) {
  (function (i) {
    setTimeout(function () {
      console.log(lis[i].innerHTML);
    }, 3000); // 3 ç§’ä¹‹åä¸€æ¬¡å…¨éƒ¨æ‰“å°
  })(i);
}

// å†™æ³•2ï¼šéé—­åŒ…ï¼ˆä¸€æ¬¡è¾“å‡º 0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼‰
const output = function (i) {
  setTimeout(function () {
    console.log(i);
  }, 1000);
};
for (let i = 0; i < 5; i++) {
  output(i);
}

// Promise å†™æ³•ï¼ˆéš” 1 ç§’ä¾æ¬¡è¾“å‡º 0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼‰
const tasks = []; // å­˜æ”¾å¼‚æ­¥æ“ä½œçš„ Promise
const output = (i) =>
  new Promise((resolve) => {
    setTimeout(() => {
      console.log(i);
    }, 1000 * i);
  });

for (let i = 0; i < 5; i++) {
  tasks.push(output(i)); // ç”Ÿæˆå…¨éƒ¨çš„å¼‚æ­¥æ“ä½œ
}
Promise.all(tasks); // æ‰§è¡Œæ‰€æœ‰çš„Promiseï¼Œé—´éš” 1 ç§’è¾“å‡º 0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4

// async awaitï¼ˆES7 æ–°å¢ï¼‰
const sleep = (timeoutMS) =>
  new Promise((resolve) => {
    // è®¾ç½®ä¸€ä¸ªå¼‚æ­¥æ“ä½œ
    setTimeout(resolve, timeoutMS); // æŒ‡å®šæ—¶é—´ä¹‹åè°ƒç”¨ resolve
  });
(async () => {
  // å£°æ˜å³æ‰§è¡Œçš„ async å¼‚æ­¥å‡½æ•°
  for (let i = 0; i < 5; i++) {
    await sleep(1000);
    console.log(i);
  }
})();
```

#### é—­åŒ…çš„ä¼˜ç¼ºç‚¹

ä¼˜ç‚¹ï¼š**è·¨ä½œç”¨åŸŸè®¿é—®å˜é‡**ï¼›è®©è¿™äº›å˜é‡çš„å€¼å§‹ç»ˆä¿å­˜åœ¨å†…å­˜ä¸­ï¼›
ç¼ºç‚¹ï¼šå†…å­˜æ¶ˆè€—å¤§ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜æ³„æ¼ï¼ˆè¦å°†ä¸ä½¿ç”¨çš„å±€éƒ¨å˜é‡åˆ é™¤ï¼‰

#### é—­åŒ…ä½¿ç”¨åœºæ™¯

- é—­åŒ…çš„ä½¿ç”¨åœºæ™¯åŒ…å«ä¸¤ç‚¹ï¼šåˆ›å»ºç§æœ‰å˜é‡å’Œå»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ
- åªè¦å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œå°±æœ‰é—­åŒ…ï¼›åªè¦ä½¿ç”¨äº†å›è°ƒå‡½æ•°ï¼Œéƒ½æœ‰é—­åŒ…çš„åº”ç”¨
- å®šæ—¶å™¨ï¼Œäº‹ä»¶ç›‘å¬ï¼Œajax è¯·æ±‚ï¼Œé˜²æŠ–èŠ‚æµç­‰

## é€’å½’å‡½æ•°

ä¸€ä¸ªå‡½æ•°å†…éƒ¨è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯é€’å½’å‡½æ•°

```js
let num = 1;

function fn() {
  console.log("æˆ‘è¦æ‰“å° 6 å¥è¯");
  if (num == 6) {
    return; // é€’å½’é‡Œé¢å¿…é¡»åŠ é€€å‡ºæ¡ä»¶
  }
  num++;
  fn(); // è°ƒç”¨è‡ªèº«
}
fn();

// é€’å½’æ±‚é˜¶ä¹˜
function fn(n) {
  if (n == 1) {
    return 1;
  }
  return n * fn(n - 1);
}

// é€’å½’æ±‚ fb æ•°åˆ—
function fb(n) {
  if (n == 1 || n == 2) {
    return 1;
  }
  return fb(n - 1) + fb(n - 2);
}
```

### èµ‹å€¼å’Œæ·±æµ…æ‹·è´

æ·±æ‹·è´å’Œæµ…æ‹·è´æ˜¯åªé’ˆå¯¹ Object å’Œ Array è¿™æ ·çš„å¼•ç”¨æ•°æ®ç±»å‹çš„ã€‚

èµ‹å€¼å’Œæµ…æ‹·è´çš„åŒºåˆ«ï¼šèµ‹å€¼æ˜¯èµ‹çš„å¯¹è±¡åœ¨**æ ˆä¸­çš„åœ°å€**ï¼Œä¸æ˜¯**å †ä¸­çš„æ•°æ®**ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼›è€Œæµ…æ‹·è´ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ–°å¯¹è±¡æœ‰ç€åŸå§‹å¯¹è±¡å±æ€§çš„ä¸€ä»½ç²¾ç¡®æ‹·è´ï¼Œå¦‚æœå±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼Œå°±æ‹·è´å€¼ï¼Œå¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œå°±æ‹·è´å†…å­˜åœ°å€ã€‚

```js
const obj = {
  id: 1,
  name: "Andy",
  msg: { age: 18 },
};

const shallow = {};

// æµ…æ‹·è´ 1.for å¾ªç¯æ‹·è´
for (const k in obj) {
  shallow[k] = obj[k]; // å¯¹äº obj ä¸­çš„ msgï¼ˆå¤æ‚æ•°æ®ç±»å‹ï¼‰åªä¼šæ‹·è´å…¶åœ°å€
}
// æµ…æ‹·è´ 2.Object.assign()
Object.assign(shallow, obj); // æŠŠ obj æµ…æ‹·è´ç»™ shallowï¼Œå®é™…ä¸Šæ˜¯åˆå¹¶å¯¹è±¡

// æµ…æ‹·è´ 3.arr.concat()
const arr2 = arr.concat(); // é‡Œé¢å•¥éƒ½ä¸å†™ï¼Œå°±æ˜¯æµ…æ‹·è´

// æµ…æ‹·è´ 4.arr.slice()
const arr2 = arr.slice(); // é‡Œé¢å•¥éƒ½ä¸å†™ï¼Œå°±æ˜¯æµ…æ‹·è´

// æµ…æ‹·è´ 5.å¯¹è±¡è§£æ„
const arr2 = { ...arr };

// æ·±æ‹·è´ JSON.parse(JSON.stringify())
const arr2 = JSON.parse(JSON.stringify(arr)); // æ— æ³•å¤„ç†å‡½æ•°

// æ·±æ‹·è´ å‡½æ•°åº“ lodash é‡Œé¢çš„ cloneDeep() æ–¹æ³•
```

**é€’å½’å®ç°æ·±æ‹·è´**

```js
// æ–¹æ³•1
const deepClone = (obj) => {
  // 1. åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ (é€’å½’å‡ºå£)
  if (obj === null || typeof obj !== "object") {
    return obj;
  }

  // 2. åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡æˆ–æ•°ç»„
  const clone = Array.isArray(obj) ? [] : {};

  // 5. è®¾ç½®å¯¹è±¡çš„åŸå‹
  Object.setPrototypeOf(clone, Object.getPrototypeOf(obj));

  // 3. éå†å¯¹è±¡æˆ–æ•°ç»„çš„æ¯ä¸€ä¸ªå±æ€§
  /**
   * for (const key of Object.keys(obj)) åªéå†å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾å±æ€§ï¼ˆä¸åŒ…æ‹¬ç»§æ‰¿çš„å±æ€§ï¼‰
   * for (let key in obj) éå†å¯¹è±¡çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ŒåŒ…æ‹¬å¯¹è±¡åŸå‹é“¾ä¸Šçš„å¯æšä¸¾å±æ€§
   * æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ä¸åŒçš„éå†æ–¹å¼
   */
  for (const key of Object.keys(obj)) {
    clone[key] = deepClone(obj[key]); // é€’å½’æ‹·è´å±æ€§
  }

  // 4. è¿”å›æ–°çš„å¯¹è±¡æˆ–æ•°ç»„
  return clone;
};

// æ–¹æ³•2 (é˜²æ­¢å¾ªç¯å¼•ç”¨)
const deepCloneHash = (obj, hash = new WeakMap()) => {
  // ä½¿ç”¨ WeakMapï¼Œå½“ map ä¸­å¼•ç”¨çš„å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œä¼šè‡ªåŠ¨åƒåœ¾å›æ”¶
  // 1. åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ (é€’å½’å‡ºå£)
  if (obj === null || typeof obj !== "object") {
    return obj;
  }

  // 2. æ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œç›´æ¥ä»å“ˆå¸Œè¡¨ä¸­å–å‡ºç»“æœ
  if (hash.has(obj)) {
    return hash.get(obj);
  }

  // 3. åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡æˆ–æ•°ç»„
  const clone = Array.isArray(obj) ? [] : {};

  // 4. å°†æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­
  hash.set(obj, clone);

  // 5. éå†å¯¹è±¡æˆ–æ•°ç»„çš„æ¯ä¸€ä¸ªå±æ€§
  for (const key of Object.keys(obj)) {
    clone[key] = deepCloneHash(obj[key], hash); // é€’å½’æ‹·è´å±æ€§
  }

  // 6. è¿”å›æ–°çš„å¯¹è±¡æˆ–æ•°ç»„
  return clone;
};
```

## å‡½æ•°æŸ¯é‡ŒåŒ–

æŠŠæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬åŒ–æˆå¤šä¸ªåªæ¥æ”¶ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼›æŠŠå‡½æ•°çš„è¿”å›å€¼è®¾ä¸ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå®ç°å‚æ•°å¤ç”¨

```js
// before
function myInfo(info, name, age) {
  return `${info}ï¼š${name}${age}`;
}
const myInfo = myInfo("ä¸ªäººä¿¡æ¯", "evan", "19"); // ä¸ªäººä¿¡æ¯ï¼šljc19

//  after curring
function myInfoCurry(info) {
  return (name) => {
    return (age) => {
      return `${info}ï¼š${name}${age}`;
    };
  };
}
const myInfo = myInfoCurry("ä¸ªäººä¿¡æ¯")("evan")("19"); // ä¸ªäººä¿¡æ¯ï¼šljc19
```

## æ‰å¹³æ•°æ®ç»“æ„å’Œæ ‘è§£æ„è½¬æ¢

```js
const items = [
  { id: 1, name: "Item 1", pid: 0 },
  { id: 2, name: "Item 2", pid: 1 },
  { id: 3, name: "Item 3", pid: 1 },
  { id: 4, name: "Item 4", pid: 3 },
  { id: 5, name: "Item 5", pid: 4 },
];

const tree = {
  id: 1,
  name: "Item 1",
  pid: 0,
  children: [
    {
      id: 2,
      name: "Item 2",
      pid: 1,
      children: [],
    },
    {
      id: 3,
      name: "Item 3",
      pid: 1,
      children: [
        {
          id: 4,
          name: "Item 4",
          pid: 3,
          children: [
            {
              id: 5,
              name: "Item 5",
              pid: 4,
              children: [],
            },
          ],
        },
      ],
    },
  ],
};
```

1ï¸âƒ£ æ•°ç»„è½¬å¯¹è±¡

```js
const arrayToTree = (arr) => {
  // 1. åˆå§‹åŒ–æ ¹èŠ‚ç‚¹å’ŒæŸ¥æ‰¾è¡¨
  let result = {};
  const lookup = {};

  // 2. åˆ›å»ºæŸ¥æ‰¾è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä»¥å…¶ id ä¸ºé”®å­˜å‚¨åœ¨ lookup ä¸­ï¼Œå¹¶åˆå§‹åŒ– children å±æ€§ä¸ºç©ºæ•°ç»„
  arr.forEach((item) => {
    lookup[item.id] = { ...item, children: [] };
  });

  // 3. æ„å»ºæ ‘ç»“æ„
  arr.forEach((item) => {
    // è·å–å½“å‰å…ƒç´ åœ¨æŸ¥æ‰¾è¡¨ä¸­çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹
    const treeItem = lookup[item.id];
    if (item.pid === null || item.pid === 0) {
      // 1. å¦‚æœå½“å‰å…ƒç´ æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç›´æ¥å°†å…¶èµ‹å€¼ç»™æ ¹èŠ‚ç‚¹
      result = treeItem;
    } else {
      // 2. å¦‚æœå½“å‰å…ƒç´ æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå°†å…¶æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„ children æ•°ç»„ä¸­
      const parent = lookup[item.pid];
      if (parent) {
        parent.children.push(treeItem);
      }
    }
  });

  // 4. è¿”å›æ ¹èŠ‚ç‚¹æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«æ‰€æœ‰çš„æ ‘ç»“æ„
  return result;
};

// ä½¿ç”¨ JSON.stringify æ‰“å°æ•°æ® (å¦åˆ™åœ¨æ§åˆ¶å°çœ‹åˆ°çš„æ˜¯ Object)
console.log(JSON.stringify(arrayToTree(items), null, 2));
```

2ï¸âƒ£ å¯¹è±¡è½¬æ•°ç»„

```js
const treeToArray = (obj) => {
  // åˆå§‹åŒ–ç»“æœæ•°ç»„
  const result = [];

  const traverse = (node) => {
    // ç§»é™¤ children å±æ€§
    const { children, ...item } = node;
    result.push(item);
    // é€’å½’éå† children

    if (children?.length) {
      children.forEach((child) => traverse(child));
    }
  };

  traverse(obj);

  return result;
};
```
